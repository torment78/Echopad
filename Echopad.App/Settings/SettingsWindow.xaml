<Window x:Class="Echopad.App.Settings.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Echopad Settings"
        Width="740"
        MinHeight="1350"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource BgBrush}"
        Foreground="{DynamicResource TextBrush}"
        Height="1295">

    <Window.Resources>

        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- ===== Palette (GRAY THEME) ===== -->
        <SolidColorBrush x:Key="BgBrush" Color="#212121"/>
        <SolidColorBrush x:Key="PanelBrush" Color="#212121"/>
        <SolidColorBrush x:Key="ControlBgBrush" Color="#181818"/>
        <SolidColorBrush x:Key="ControlBorderBrush" Color="#303030"/>
        <SolidColorBrush x:Key="ControlHoverBrush" Color="#242424"/>
        <SolidColorBrush x:Key="ControlPressedBrush" Color="#1D1D1D"/>
        <SolidColorBrush x:Key="TextBrush" Color="#EAEAEA"/>
        <SolidColorBrush x:Key="MutedTextBrush" Color="#B8B8B8"/>

        <SolidColorBrush x:Key="DropBgBrush" Color="#181818"/>
        <SolidColorBrush x:Key="DropItemHoverBrush" Color="#242424"/>
        <SolidColorBrush x:Key="DropItemSelectedBrush" Color="#303030"/>

        <Style TargetType="{x:Type GroupBox}">
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
            <Setter Property="Background" Value="{StaticResource PanelBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style TargetType="{x:Type TextBlock}">
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
        </Style>

        <Style TargetType="{x:Type TextBox}">
            <Setter Property="Background" Value="{StaticResource ControlBgBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6"/>
        </Style>

        <Style TargetType="{x:Type ListBox}">
            <Setter Property="Background" Value="{StaticResource ControlBgBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style TargetType="{x:Type ListBoxItem}">
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ListBoxItem}">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" CornerRadius="6">
                            <ContentPresenter Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource DropItemHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource DropItemSelectedBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.45"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ===== Dark ComboBox (dropdown fixed) ===== -->
        <Style TargetType="{x:Type ComboBox}">
            <Setter Property="Background" Value="{StaticResource ControlBgBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="MinHeight" Value="30"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ComboBox}">
                        <Grid>
                            <Border x:Name="Border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="8"
                                    Padding="8,4">
                                <DockPanel>
                                    <ToggleButton x:Name="Toggle"
                                                  DockPanel.Dock="Right"
                                                  Focusable="False"
                                                  IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                  Background="Transparent"
                                                  BorderThickness="0"
                                                  Width="28"
                                                  HorizontalContentAlignment="Center"
                                                  VerticalContentAlignment="Center">
                                        <TextBlock Text="▾" Foreground="{StaticResource MutedTextBrush}" FontSize="14"/>
                                    </ToggleButton>

                                    <ContentPresenter Margin="0"
                                                      Content="{TemplateBinding SelectionBoxItem}"
                                                      ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                      ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                      VerticalAlignment="Center"
                                                      HorizontalAlignment="Left"
                                                      RecognizesAccessKey="True"/>
                                </DockPanel>
                            </Border>

                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Fade">
                                <Border Background="{StaticResource DropBgBrush}"
                                        BorderBrush="{StaticResource ControlBorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="10"
                                        Padding="4"
                                        SnapsToDevicePixels="True">
                                    <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource ControlHoverBrush}"/>
                                <Setter TargetName="Border" Property="BorderBrush" Value="#3A4D68"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="{x:Type ComboBoxItem}">
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ComboBoxItem}">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" CornerRadius="8">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource DropItemHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource DropItemSelectedBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.45"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Global Settings"
                   FontSize="22"
                   FontWeight="Bold"
                   Margin="0,0,0,12"/>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- AUDIO ROUTING -->
                <GroupBox Header="Audio Routing" Margin="0,0,0,12">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Input 1:" VerticalAlignment="Center"/>

                        <!-- Input 1 Combo + empty hint + VU -->
                        <Grid Grid.Row="0" Grid.Column="1">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Combo (row 0) -->
                            <ComboBox Grid.Row="0"
              ItemsSource="{Binding AudioInputs}"
              SelectedValuePath="Id"
              DisplayMemberPath="Name"
              SelectedValue="{Binding Input1DeviceId}"
              IsSynchronizedWithCurrentItem="False"/>

                            <!-- Empty hint overlay (row 0) -->
                            <TextBlock Grid.Row="0"
               Text="No audio input devices found"
               Margin="10,0,0,0"
               VerticalAlignment="Center"
               Foreground="{StaticResource MutedTextBrush}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding AudioInputs.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>

                            <!-- VU row -->
                            <Grid Grid.Row="1" Margin="0,6,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>

                                <ProgressBar Grid.Column="0"
                     x:Name="VuInput1"
                     Minimum="0" Maximum="1"
                     Height="10"
                     VerticalAlignment="Center"/>

                                <TextBlock Grid.Column="1"
                   x:Name="VuInput1Db"
                   Text="-inf"
                   Margin="8,0,0,0"
                   VerticalAlignment="Center"
                   HorizontalAlignment="Right"/>
                            </Grid>
                        </Grid>


                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Input 2:" VerticalAlignment="Center" Margin="12,0,0,0"/>

                        <!-- Input 2 Combo + empty hint + VU -->
                        <Grid Grid.Row="0" Grid.Column="3">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Combo (row 0) -->
                            <ComboBox Grid.Row="0"
              ItemsSource="{Binding AudioInputs}"
              SelectedValuePath="Id"
              DisplayMemberPath="Name"
              SelectedValue="{Binding Input2DeviceId}"
              IsSynchronizedWithCurrentItem="False"/>

                            <!-- Empty hint overlay (row 0) -->
                            <TextBlock Grid.Row="0"
               Text="No audio input devices found"
               Margin="10,0,0,0"
               VerticalAlignment="Center"
               Foreground="{StaticResource MutedTextBrush}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding AudioInputs.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>

                            <!-- VU row -->
                            <Grid Grid.Row="1" Margin="0,6,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>

                                <ProgressBar Grid.Column="0"
                     x:Name="VuInput2"
                     Minimum="0" Maximum="1"
                     Height="10"
                     VerticalAlignment="Center"/>

                                <TextBlock Grid.Column="1"
                   x:Name="VuInput2Db"
                   Text="-inf"
                   Margin="8,0,0,0"
                   VerticalAlignment="Center"
                   HorizontalAlignment="Right"/>
                            </Grid>
                        </Grid>


                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Main Out:" VerticalAlignment="Center" Margin="0,10,0,0"/>

                        <!-- Main Out Combo + empty hint -->
                        <Grid Grid.Row="1" Grid.Column="1" Margin="0,10,0,0">
                            <ComboBox ItemsSource="{Binding AudioOutputs}"
                                      SelectedValuePath="Id"
                                      DisplayMemberPath="Name"
                                      SelectedValue="{Binding MainOutDeviceId}"
                                      IsSynchronizedWithCurrentItem="False"/>

                            <TextBlock Text="No audio output devices found"
                                       Margin="10,0,0,0"
                                       VerticalAlignment="Center"
                                       Foreground="{StaticResource MutedTextBrush}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding AudioOutputs.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>

                        <TextBlock Grid.Row="1" Grid.Column="2" Text="Monitor Out:" VerticalAlignment="Center" Margin="12,10,0,0"/>

                        <!-- Monitor Out Combo + empty hint -->
                        <Grid Grid.Row="1" Grid.Column="3" Margin="0,10,0,0">
                            <ComboBox ItemsSource="{Binding AudioOutputs}"
                                      SelectedValuePath="Id"
                                      DisplayMemberPath="Name"
                                      SelectedValue="{Binding MonitorOutDeviceId}"
                                      IsSynchronizedWithCurrentItem="False"/>

                            <TextBlock Text="No audio output devices found"
                                       Margin="10,0,0,0"
                                       VerticalAlignment="Center"
                                       Foreground="{StaticResource MutedTextBrush}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding AudioOutputs.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>

                    </Grid>
                </GroupBox>

                <!-- MIDI -->
                <GroupBox Header="MIDI" Margin="0,0,0,12">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- OLD:
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        -->

                        <!-- NEW: add 2 more rows for Armed values -->
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="MIDI In:" VerticalAlignment="Center"/>

                        <Grid Grid.Row="0" Grid.Column="1">
                            <ComboBox ItemsSource="{Binding MidiInputs}"
                      SelectedValuePath="Id"
                      DisplayMemberPath="Name"
                      SelectedValue="{Binding MidiInDeviceId}"
                      IsSynchronizedWithCurrentItem="False"/>

                            <TextBlock Text="No MIDI input devices found"
                       Margin="10,0,0,0"
                       VerticalAlignment="Center"
                       Foreground="{StaticResource MutedTextBrush}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding MidiInputs.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="MIDI Out:" VerticalAlignment="Center" Margin="0,10,0,0"/>

                        <Grid Grid.Row="1" Grid.Column="1" Margin="0,10,0,0">
                            <ComboBox ItemsSource="{Binding MidiOutputs}"
                      SelectedValuePath="Id"
                      DisplayMemberPath="Name"
                      SelectedValue="{Binding MidiOutDeviceId}"
                      IsSynchronizedWithCurrentItem="False"/>

                            <TextBlock Text="No MIDI output devices found"
                       Margin="10,0,0,0"
                       VerticalAlignment="Center"
                       Foreground="{StaticResource MutedTextBrush}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding MidiOutputs.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>

                        <!-- NEW: Global "Armed" LED values -->
                        <TextBlock Grid.Row="2" Grid.Column="0"
                   Text="Armed (Input 1):"
                   VerticalAlignment="Center"
                   Margin="0,10,0,0"/>

                        <Grid Grid.Row="2" Grid.Column="1" Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0"
                     Text="{Binding MidiArmedInput1Value, UpdateSourceTrigger=PropertyChanged}"
                     HorizontalContentAlignment="Center"/>

                            <TextBlock Grid.Column="1"
                       Text="0–127 (MIDI value used when pad is Armed on Input 1)"
                       Opacity="0.7"
                       VerticalAlignment="Center"
                       Margin="10,0,0,0"/>
                        </Grid>

                        <TextBlock Grid.Row="3" Grid.Column="0"
                   Text="Armed (Input 2):"
                   VerticalAlignment="Center"
                   Margin="0,10,0,0"/>

                        <Grid Grid.Row="3" Grid.Column="1" Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0"
                     Text="{Binding MidiArmedInput2Value, UpdateSourceTrigger=PropertyChanged}"
                     HorizontalContentAlignment="Center"/>

                            <TextBlock Grid.Column="1"
                       Text="0–127 (MIDI value used when pad is Armed on Input 2)"
                       Opacity="0.7"
                       VerticalAlignment="Center"
                       Margin="10,0,0,0"/>
                        </Grid>

                    </Grid>
                </GroupBox>
                <!-- GLOBAL UI COLORS -->
                <GroupBox Header="Global UI Colors" Margin="0,0,0,12">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="170"/>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Armed Input 1 -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Armed (Input 1 Hex):" VerticalAlignment="Center"/>
                        <TextBox  Grid.Row="0" Grid.Column="1"
                  Text="{Binding UiArmedInput1Hex, UpdateSourceTrigger=PropertyChanged}"
                  HorizontalContentAlignment="Center"/>
                        <TextBlock Grid.Row="0" Grid.Column="2"
                   Text="Used when a pad is Armed and Input Source = 1 (example: #FF4DB8)"
                   Opacity="0.7"
                   VerticalAlignment="Center"
                   Margin="10,0,0,0"/>

                        <!-- Armed Input 2 -->
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Armed (Input 2 Hex):" VerticalAlignment="Center" Margin="0,10,0,0"/>
                        <TextBox  Grid.Row="1" Grid.Column="1"
                  Margin="0,10,0,0"
                  Text="{Binding UiArmedInput2Hex, UpdateSourceTrigger=PropertyChanged}"
                  HorizontalContentAlignment="Center"/>
                        <TextBlock Grid.Row="1" Grid.Column="2"
                   Margin="10,10,0,0"
                   Text="Used when a pad is Armed and Input Source = 2 (example: #4DA3FF)"
                   Opacity="0.7"
                   VerticalAlignment="Center"/>

                        
                    </Grid>
                </GroupBox>

                <!-- GLOBAL ACTIONS -->
                <GroupBox Header="Global Actions (Hotkeys + MIDI)" Margin="0,0,0,12">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="160"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Toggle Edit:" VerticalAlignment="Center"/>

                        <TextBlock Grid.Row="0" Grid.Column="1"
                                   Text="{Binding MidiBindToggleEdit}"
                                   Opacity="0.85"
                                   VerticalAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>

                        <Button Grid.Row="0" Grid.Column="2"
                                Content="Learn MIDI"
                                Margin="10,0,10,0"
                                Click="LearnMidi_ToggleEdit_Click"/>

                        <TextBlock Grid.Row="0" Grid.Column="3"
                                   Text="{Binding HotkeyToggleEdit}"
                                   Opacity="0.85"
                                   VerticalAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>

                        <Button Grid.Row="0" Grid.Column="4"
                                Content="Set Hotkey"
                                Margin="10,0,0,0"
                                Click="SetHotkey_ToggleEdit_Click"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Open Settings:" VerticalAlignment="Center" Margin="0,10,0,0"/>

                        <TextBlock Grid.Row="1" Grid.Column="1"
                                   Text="{Binding MidiBindOpenSettings}"
                                   Opacity="0.85"
                                   VerticalAlignment="Center"
                                   TextTrimming="CharacterEllipsis"
                                   Margin="0,10,0,0"/>

                        <Button Grid.Row="1" Grid.Column="2"
                                Content="Learn MIDI"
                                Margin="10,10,10,0"
                                Click="LearnMidi_OpenSettings_Click"/>

                        <TextBlock Grid.Row="1" Grid.Column="3"
                                   Text="{Binding HotkeyOpenSettings}"
                                   Opacity="0.85"
                                   VerticalAlignment="Center"
                                   TextTrimming="CharacterEllipsis"
                                   Margin="0,10,0,0"/>

                        <Button Grid.Row="1" Grid.Column="4"
                                Content="Set Hotkey"
                                Margin="10,10,0,0"
                                Click="SetHotkey_OpenSettings_Click"/>
                    </Grid>
                </GroupBox>

                <!-- TRIM CONTROLS -->
                <GroupBox Header="Trim Controls (Global Hotkeys + MIDI)" Margin="0,0,0,12">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="160"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Select IN (Start):" VerticalAlignment="Center"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding MidiBindTrimSelectIn}" Opacity="0.85" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                        <Button Grid.Row="0" Grid.Column="2" Content="Learn MIDI" Margin="10,0,10,0" Click="LearnMidi_TrimSelectIn_Click"/>
                        <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding HotkeyTrimSelectIn}" Opacity="0.85" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                        <Button Grid.Row="0" Grid.Column="4" Content="Set Hotkey" Margin="10,0,0,0" Click="SetHotkey_TrimSelectIn_Click"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Select OUT (End):" VerticalAlignment="Center" Margin="0,10,0,0"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding MidiBindTrimSelectOut}" Opacity="0.85" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Margin="0,10,0,0"/>
                        <Button Grid.Row="1" Grid.Column="2" Content="Learn MIDI" Margin="10,10,10,0" Click="LearnMidi_TrimSelectOut_Click"/>
                        <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding HotkeyTrimSelectOut}" Opacity="0.85" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Margin="0,10,0,0"/>
                        <Button Grid.Row="1" Grid.Column="4" Content="Set Hotkey" Margin="10,10,0,0" Click="SetHotkey_TrimSelectOut_Click"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Nudge +:" VerticalAlignment="Center" Margin="0,10,0,0"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding MidiBindTrimNudgePlus}" Opacity="0.85" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Margin="0,10,0,0"/>
                        <Button Grid.Row="2" Grid.Column="2" Content="Learn MIDI" Margin="10,10,10,0" Click="LearnMidi_TrimPlus_Click"/>
                        <TextBlock Grid.Row="2" Grid.Column="3" Text="{Binding HotkeyTrimNudgePlus}" Opacity="0.85" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Margin="0,10,0,0"/>
                        <Button Grid.Row="2" Grid.Column="4" Content="Set Hotkey" Margin="10,10,0,0" Click="SetHotkey_TrimPlus_Click"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Nudge −:" VerticalAlignment="Center" Margin="0,10,0,0"/>
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding MidiBindTrimNudgeMinus}" Opacity="0.85" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Margin="0,10,0,0"/>
                        <Button Grid.Row="3" Grid.Column="2" Content="Learn MIDI" Margin="10,10,10,0" Click="LearnMidi_TrimMinus_Click"/>
                        <TextBlock Grid.Row="3" Grid.Column="3" Text="{Binding HotkeyTrimNudgeMinus}" Opacity="0.85" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Margin="0,10,0,0"/>
                        <Button Grid.Row="3" Grid.Column="4" Content="Set Hotkey" Margin="10,10,0,0" Click="SetHotkey_TrimMinus_Click"/>
                    </Grid>
                </GroupBox>

                <!-- FOLDERS -->
                <GroupBox Header="Audio Folders (Import/Drop Pools)">
                    <Grid Margin="12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <ListBox x:Name="FoldersList"
                                 ItemsSource="{Binding AudioFolders}"
                                 Height="160"/>

                        <!-- Existing buttons -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                            <Button Content="Add Folder..." Width="120" Margin="0,0,8,0" Click="AddFolder_Click"/>
                            <Button Content="Remove Selected" Width="140" Click="RemoveFolder_Click"/>
                        </StackPanel>

                        <!-- NEW: Drop Folder controls using the same pool list -->
                        <GroupBox Grid.Row="2" Header="Drop Folder (Watch Folder)" Margin="0,12,0,0">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <CheckBox Grid.Row="0"
                                          Content="Enable Drop Folder Watcher"
                                          IsChecked="{Binding DropFolderEnabled}"/>

                                <TextBox Grid.Row="1"
                                         Margin="0,10,0,0"
                                         Text="{Binding DropWatchFolder}"
                                         IsReadOnly="True"
                                         Opacity="0.95"/>

                                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                    <Button Content="Use Selected as Drop Folder"
                                            Width="220"
                                            Margin="0,0,8,0"
                                            Click="UseSelectedAsDropFolder_Click"/>

                                    <Button Content="Browse..."
                                            Width="110"
                                            Margin="0,0,8,0"
                                            Click="BrowseDropWatchFolder_Click"/>

                                    <Button Content="Open"
                                            Width="90"
                                            Margin="0,0,8,0"
                                            Click="OpenDropWatchFolder_Click"/>

                                    <Button Content="Default"
                                            Width="90"
                                            Margin="0,0,8,0"
                                            Click="CreateDefaultDropWatchFolder_Click"/>

                                    <Button Content="Clear"
                                            Width="90"
                                            Click="ClearDropWatchFolder_Click"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>

                    </Grid>
                </GroupBox>

                <TextBlock Margin="0,10,0,0"
                           Opacity="0.7"
                           TextWrapping="Wrap"
                           Text="Note: Drop-mode assignment (auto-fill pads from watched folders) requires at least one pad to have Drop Folder Mode enabled in Pad Settings."/>
            </StackPanel>
        </ScrollViewer>

        <!-- FOOTER -->
        <StackPanel Grid.Row="2"
            Orientation="Horizontal"
            HorizontalAlignment="Right"
            Margin="0,12,0,0">

            <!-- NEW: MIDI OUT test (value 25) -->
            <Button Content="Test LED (Send 25)"
            Width="160"
            Margin="0,0,8,0"
            Click="TestMidiOut25_Click"/>

            <Button Content="Cancel"
            Width="100"
            Margin="0,0,8,0"
            Click="Cancel_Click"/>

            <Button Content="Save"
            Width="100"
            Click="Save_Click"/>
        </StackPanel>

    </Grid>
</Window>
